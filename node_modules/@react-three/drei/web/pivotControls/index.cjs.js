"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("@babel/runtime/helpers/extends"),r=require("@react-three/fiber"),t=require("react"),i=require("three"),a=require("./AxisArrow.cjs.js"),o=require("./AxisRotator.cjs.js"),n=require("./PlaneSlider.cjs.js"),c=require("./context.cjs.js"),l=require("../../core/calculateScaleFactor.cjs.js");function s(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}function u(e){if(e&&e.__esModule)return e;var r=Object.create(null);return e&&Object.keys(e).forEach((function(t){if("default"!==t){var i=Object.getOwnPropertyDescriptor(e,t);Object.defineProperty(r,t,i.get?i:{enumerable:!0,get:function(){return e[t]}})}})),r.default=e,Object.freeze(r)}require("../../core/Line.cjs.js"),require("three-stdlib"),require("../Html.cjs.js"),require("react-dom/client");var d=s(e),x=u(t),m=u(i);const p=new m.Matrix4,f=new m.Matrix4,y=new m.Matrix4,w=new m.Matrix4,v=new m.Matrix4,g=new m.Matrix4,j=new m.Matrix4,b=new m.Matrix4,E=new m.Box3,A=new m.Box3,h=new m.Vector3,M=new m.Vector3,q=new m.Vector3,S=new m.Vector3,R=new m.Vector3(1,0,0),P=new m.Vector3(0,1,0),D=new m.Vector3(0,0,1),V=x.forwardRef((({matrix:e,onDragStart:t,onDrag:i,onDragEnd:s,autoTransform:u=!0,anchor:V,disableAxes:W=!1,disableSliders:C=!1,disableRotations:L=!1,activeAxes:O=[!0,!0,!0],offset:B=[0,0,0],rotation:T=[0,0,0],scale:_=1,lineWidth:z=4,fixed:F=!1,translationLimits:k,rotationLimits:H,depthTest:I=!0,axisColors:U=["#ff2060","#20df80","#2080ff"],hoveredColor:G="#ffff40",annotations:J=!1,annotationsClass:K,opacity:N=1,visible:Q=!0,userData:X,children:Y,...Z},$)=>{const ee=r.useThree((e=>e.invalidate)),re=x.useRef(null),te=x.useRef(null),ie=x.useRef(null),ae=x.useRef(null),oe=x.useRef([0,0,0]);x.useLayoutEffect((()=>{V&&(ae.current.updateWorldMatrix(!0,!0),w.copy(ae.current.matrixWorld).invert(),E.makeEmpty(),ae.current.traverse((e=>{e.geometry&&(e.geometry.boundingBox||e.geometry.computeBoundingBox(),g.copy(e.matrixWorld).premultiply(w),A.copy(e.geometry.boundingBox),A.applyMatrix4(g),E.union(A))})),h.copy(E.max).add(E.min).multiplyScalar(.5),M.copy(E.max).sub(E.min).multiplyScalar(.5),q.copy(M).multiply(new m.Vector3(...V)).add(h),S.set(...B).add(q),ie.current.position.copy(S),ee())}));const ne=x.useMemo((()=>({onDragStart:e=>{p.copy(te.current.matrix),f.copy(te.current.matrixWorld),t&&t(e),ee()},onDrag:e=>{y.copy(re.current.matrixWorld),w.copy(y).invert(),v.copy(f).premultiply(e),g.copy(v).premultiply(w),j.copy(p).invert(),b.copy(g).multiply(j),u&&te.current.matrix.copy(g),i&&i(g,b,v,e),ee()},onDragEnd:()=>{s&&s(),ee()},translation:oe,translationLimits:k,rotationLimits:H,axisColors:U,hoveredColor:G,opacity:N,scale:_,lineWidth:z,fixed:F,depthTest:I,userData:X,annotations:J,annotationsClass:K})),[t,i,s,oe,k,H,I,_,z,F,...U,G,N,X,u,J,K]),ce=new m.Vector3;return r.useFrame((e=>{if(F){const a=l.calculateScaleFactor(ie.current.getWorldPosition(ce),_,e.camera,e.size);var r,t,i;if(ie.current)(null==(r=ie.current)?void 0:r.scale.x)===a&&(null==(t=ie.current)?void 0:t.scale.y)===a&&(null==(i=ie.current)?void 0:i.scale.z)===a||(ie.current.scale.setScalar(a),e.invalidate())}})),x.useImperativeHandle($,(()=>te.current),[]),x.useLayoutEffect((()=>{e&&e instanceof m.Matrix4&&(te.current.matrix=e)}),[e]),x.createElement(c.context.Provider,{value:ne},x.createElement("group",{ref:re},x.createElement("group",d.default({ref:te,matrix:e,matrixAutoUpdate:!1},Z),x.createElement("group",{visible:Q,ref:ie,position:B,rotation:T},!W&&O[0]&&x.createElement(a.AxisArrow,{axis:0,direction:R}),!W&&O[1]&&x.createElement(a.AxisArrow,{axis:1,direction:P}),!W&&O[2]&&x.createElement(a.AxisArrow,{axis:2,direction:D}),!C&&O[0]&&O[1]&&x.createElement(n.PlaneSlider,{axis:2,dir1:R,dir2:P}),!C&&O[0]&&O[2]&&x.createElement(n.PlaneSlider,{axis:1,dir1:D,dir2:R}),!C&&O[2]&&O[1]&&x.createElement(n.PlaneSlider,{axis:0,dir1:P,dir2:D}),!L&&O[0]&&O[1]&&x.createElement(o.AxisRotator,{axis:2,dir1:R,dir2:P}),!L&&O[0]&&O[2]&&x.createElement(o.AxisRotator,{axis:1,dir1:D,dir2:R}),!L&&O[2]&&O[1]&&x.createElement(o.AxisRotator,{axis:0,dir1:P,dir2:D})),x.createElement("group",{ref:ae},Y))))}));exports.PivotControls=V;
